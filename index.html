<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PLSS Restoration Tool</title>
  <style>
    body { font-family: sans-serif; padding: 2rem; max-width: 800px; margin: auto; }
    input { width: 100px; margin: 0.25rem; }
    .section { margin-bottom: 2rem; }
    .feedback { margin-top: 1rem; padding: 0.5rem; border-radius: 5px; }
    .valid { background: #e0ffe0; border: 1px solid #0a0; }
    .warn { background: #fff0e0; border: 1px solid #fa0; }
    .error { background: #ffe0e0; border: 1px solid #a00; }
    .math-preview { font-family: monospace; background: #f8f8f8; padding: 1rem; border-radius: 5px; }
  </style>
</head>
<body>

  <h1>PLSS Restoration Tool</h1>

  <div class="section">
    <h2>üß≠ Orientation Guide</h2>
    <ul>
      <li>A = north of the corner</li>
      <li>B = south of the corner</li>
      <li>C = west of the corner</li>
      <li>D = east of the corner</li>
    </ul>
  </div>

  <div class="section">
    <h2>üìç Input Coordinates</h2>
    <label>A Northing: <input type="number" id="aNorthing" /></label>
    <label>B Northing: <input type="number" id="bNorthing" /></label><br/>
    <label>C Easting: <input type="number" id="cEasting" /></label>
    <label>D Easting: <input type="number" id="dEasting" /></label>
  </div>

  <div class="section">
    <h2>üìè Distances</h2>
    <label>Record AB: <input type="number" id="recordAB" /></label>
    <label>Measured AB: <input type="number" id="measuredAB" /></label><br/>
    <label>Record CD: <input type="number" id="recordCD" /></label>
    <label>Measured CD: <input type="number" id="measuredCD" /></label>
  </div>

  <div class="section">
    <button onclick="calculate()">üîç Calculate Restored Corner</button>
    <div id="feedback" class="feedback"></div>
  </div>

  <div class="section">
    <h2>üìê Live Math Preview</h2>
    <div id="mathPreview" class="math-preview"></div>
  </div>

  <script>
    function calculate() {
      const aN = parseFloat(document.getElementById("aNorthing").value);
      const bN = parseFloat(document.getElementById("bNorthing").value);
      const cE = parseFloat(document.getElementById("cEasting").value);
      const dE = parseFloat(document.getElementById("dEasting").value);
      const rAB = parseFloat(document.getElementById("recordAB").value);
      const mAB = parseFloat(document.getElementById("measuredAB").value);
      const rCD = parseFloat(document.getElementById("recordCD").value);
      const mCD = parseFloat(document.getElementById("measuredCD").value);

      const nsRatio = mAB / rAB;
      const ewRatio = mCD / rCD;

      const restoredNorthing = bN + nsRatio * (rAB);
      const restoredEasting = cE + ewRatio * (rCD);

      const nsSpan = Math.abs(aN - bN);
      const ewSpan = Math.abs(dE - cE);
      const validSpans = [2640, 5280, 7920, 10560, 13200, 15840, 18480, 21120, 23760, 26400];
      const buffer = 300;

      const feedback = [];
      const math = [];

      // Direction checks
      if (aN <= bN || aN <= restoredNorthing) feedback.push("‚ö†Ô∏è A should be north of B and the restored corner.");
      else feedback.push("‚úÖ A is north of B and the restored corner.");

      if (bN >= restoredNorthing || bN >= aN) feedback.push("‚ö†Ô∏è B should be south of A and the restored corner.");
      else feedback.push("‚úÖ B is south of A and the restored corner.");

      if (dE <= cE || dE <= restoredEasting) feedback.push("‚ö†Ô∏è D should be east of C and the restored corner.");
      else feedback.push("‚úÖ D is east of C and the restored corner.");

      if (cE >= restoredEasting || cE >= dE) feedback.push("‚ö†Ô∏è C should be west of D and the restored corner.");
      else feedback.push("‚úÖ C is west of D and the restored corner.");

      // Span checks
      const nsValid = validSpans.some(span => Math.abs(nsSpan - span) <= buffer);
      const ewValid = validSpans.some(span => Math.abs(ewSpan - span) <= buffer);

      feedback.push(nsValid ? `‚úÖ NS span (${nsSpan} ft) is valid.` : `‚ö†Ô∏è NS span (${nsSpan} ft) is not near a valid section multiple.`);
      feedback.push(ewValid ? `‚úÖ EW span (${ewSpan} ft) is valid.` : `‚ö†Ô∏è EW span (${ewSpan} ft) is not near a valid section multiple.`);

      // Math preview
      math.push(`NS Ratio = ${mAB} / ${rAB} = ${nsRatio.toFixed(4)}`);
      math.push(`EW Ratio = ${mCD} / ${rCD} = ${ewRatio.toFixed(4)}`);
      math.push(`Restored Northing = ${bN} + ${nsRatio.toFixed(4)} √ó ${rAB} = ${restoredNorthing.toFixed(2)}`);
      math.push(`Restored Easting = ${cE} + ${ewRatio.toFixed(4)} √ó ${rCD} = ${restoredEasting.toFixed(2)}`);
      math.push(`üìç Final Restored Corner: (${restoredNorthing.toFixed(2)}, ${restoredEasting.toFixed(2)})`);

      document.getElementById("feedback").innerHTML = feedback.map(f => `<div>${f}</div>`).join("");
      document.getElementById("mathPreview").innerHTML = math.join("<br/>");
    }
  </script>

</body>
</html>
